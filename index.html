<!DOCTYPE html> 
<html lang="sl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Galaktiƒçen Metulj</title>
<style>
@import url('https://fonts.googleapis.com/css2?family=Great+Vibes&display=swap');

body {
  font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
  background: #d0f0c0;
  margin: 0;
  padding: 20px;
  display: flex;
  flex-direction: column;
  align-items: center;
}

h1 { font-family: 'Great Vibes', cursive; font-size: 3em; margin: 0 0 5px 0; text-align:center; }
h2 { font-size:1.5em; margin:0 0 20px 0; color:#444; text-align:center; }

/* --- NOVO: ≈°tevec nad mre≈æo --- */
#progressBar {
  margin: 10px 0 18px 0;
  font-size: 16px;
  color: #333;
  background: rgba(255,255,255,0.7);
  padding: 8px 12px;
  border-radius: 12px;
  border: 1px solid rgba(0,0,0,0.06);
  box-shadow: 0 4px 10px rgba(0,0,0,0.06);
}

/* ohranjen container */
#container-wrapper { width: 100%; overflow-x: auto; }
#container { display: grid; grid-template-columns: 160px auto 320px; gap: 10px; background: rgba(255,255,255,0.3); padding: 10px; border-radius: 15px; box-shadow: 0 10px 30px rgba(0,0,0,0.3); min-width: max-content; }

#signs { display: grid; grid-template-rows: repeat(20, 50px); row-gap: 3px; position: sticky; left: 0; background: #fff; z-index: 2; box-shadow: 2px 0 5px rgba(0,0,0,0.1); }
.sign { display: flex; align-items: center; gap: 8px; font-size: 13px; height: 50px; line-height: 50px; white-space: nowrap; padding-left: 5px; box-sizing: border-box; }
.sign img { width: 32px; height: 32px; }

/* --- NOVO: breathing animacija za mre≈æo --- */
@keyframes breathing {
  0% { transform: scale(1); }
  50% { transform: scale(1.01); }
  100% { transform: scale(1); }
}
#grid {
  display: grid;
  grid-template-columns: repeat(13, 50px);
  grid-template-rows: repeat(20, 50px);
  gap: 3px;
  transition: transform 0.6s ease;
  animation: breathing 4s ease-in-out infinite;
}

/* ohranjen stil celic */
.cell {
  display: flex;
  justify-content: center;
  align-items: center;
  border:1px solid #999;
  font-size:13px;
  cursor:pointer;
  border-radius:5px;
  transition: all 0.2s;
  position: relative;
}

/* ≈°tevec v celici */
.cell-counter { position: absolute; bottom: 3px; right: 5px; background: rgba(0,0,0,0.6); color: #fff; font-size: 10px; border-radius: 50%; width: 16px; height: 16px; display: flex; justify-content: center; align-items: center; }

#about {
  background: rgba(255,255,255,0.9);
  padding: 15px;
  border-radius: 15px;
  border: 2px solid gold;
  box-shadow: 0 5px 15px rgba(0,0,0,0.3);
  max-width: 300px;
  font-size: 14px;
  line-height: 1.5;
  color: #333;
  overflow-y: auto;
  position: sticky;
  top: 20px;
  align-self: start;
}

/* form styling (ohranjeno) */
form { margin-top:20px; display:flex; flex-wrap:wrap; gap:10px; justify-content:center; }
input { padding: 10px; font-size: 16px; background-color: #fff; color: #000; border: 1px solid #ccc; border-radius: 5px; flex: 1 1 120px; min-width: 100px; }
button { padding: 10px 15px; font-size: 16px; cursor: pointer; border-radius: 5px; background-color: #f4d03f; border: none; flex: 0 0 auto; }

/* vnosna lista (ohranjeno) */
#list { margin: 0 auto; width: 200px; border: 1px solid #ccc; background: #fff; padding: 10px; border-radius: 10px; max-height: 300px; overflow-y: auto; box-shadow: 0 5px 15px rgba(0,0,0,0.2); display: flex; flex-direction: column; align-items: center; justify-content: flex-start; }
#list ul { list-style: none; padding: 0; margin: 0; width: 100%; text-align: center; }
#list li { margin: 5px 0; font-size: 14px; background: #f9f9f9; padding: 6px 10px; border-radius: 6px; border: 1px solid #eee; box-shadow: 0 1px 2px rgba(0,0,0,0.1); width: 100%; }

@media (max-width:480px){ .sign { font-size:12px; gap:5px; } .cell { width:40px; height:40px; font-size:12px; } #grid { grid-template-columns: repeat(13, 40px); grid-template-rows: repeat(20, 40px);} #signs { grid-template-rows: repeat(20, 40px); } }
@media(max-width: 767px) { #about { position: relative; top: auto; max-width: 380px; width: 85%; margin-bottom: 20px; justify-self: center; } }

/* Minimalno valovanje celic ob hover */
.cell:hover {
  transform: scale(1.05) translateY(-2px);
  transition: all 0.2s;
}

/* --- NOVO: Posebna animacija za vne≈°ene kine --- */
@keyframes glow {
  0% { box-shadow: 0 0 5px 2px gold; transform: scale(1.05); }
  50% { box-shadow: 0 0 15px 5px gold; transform: scale(1.1); }
  100% { box-shadow: 0 0 5px 2px gold; transform: scale(1.05); }
}

.cell-highlight {
  animation: glow 1.5s ease-in-out infinite alternate;
  z-index: 5; /* da je malce pred drugimi celicami */
  position: relative;
}

/* --- NOVO: enkratni zlati val / pulz ob vnosu (odstrani se po animaciji) --- */
@keyframes goldRipple {
  0% { box-shadow: 0 0 0 0 rgba(241, 196, 15, 0.8); transform: scale(1); }
  50% { box-shadow: 0 0 20px 8px rgba(241, 196, 15, 0.15); transform: scale(1.08); }
  100% { box-shadow: 0 0 0 0 rgba(241, 196, 15, 0); transform: scale(1); }
}
.cell-ripple {
  animation: goldRipple 1.2s ease-out forwards;
  z-index: 6;
}

/* --- NOVO: modal --- */
#modalOverlay {
  position: fixed;
  left: 0; top: 0; right: 0; bottom: 0;
  background: rgba(0,0,0,0.45);
  display: none;
  align-items: center;
  justify-content: center;
  z-index: 1000;
  padding: 20px;
}
#modal {
  background: linear-gradient(180deg, rgba(255,255,255,0.98), rgba(255,250,230,0.98));
  border-radius: 12px;
  padding: 18px;
  max-width: 420px;
  width: 100%;
  box-shadow: 0 10px 30px rgba(0,0,0,0.35);
  border: 2px solid rgba(212,175,55,0.9);
}
#modal h3 { margin: 0 0 10px 0; font-size: 20px; }
#modal p { margin: 6px 0; color: #333; line-height: 1.4; }
#modal ul { margin: 8px 0 0 16px; padding: 0; max-height: 200px; overflow-y: auto; }
#modal button { margin-top: 12px; background: #f4d03f; border: none; padding: 8px 12px; border-radius: 8px; cursor: pointer; }

/* sporoƒçilo spodaj ob vnosu */
#resultMessage {
  margin-top: 12px;
  font-size: 15px;
  background: rgba(255,255,255,0.9);
  padding: 10px 14px;
  border-radius: 10px;
  border: 1px solid rgba(0,0,0,0.06);
  max-width: 720px;
  text-align: center;
}

/* diskretni fokus za scrolanje */
.highlight-focus { outline: 3px solid rgba(255,215,0,0.25); border-radius: 6px; }

</style>
</head>
<body>

<h1>Galaktiƒçen Metulj</h1>
<h2>Tzolkin Matrika 20√ó13</h2>

<!-- ≈°tevec -->
<div id="progressBar">üåü Prebujenih je <strong id="activeCount">0</strong> / 260 galaktiƒçnih src.</div>

<div id="container-wrapper">
  <div id="container">
    <div id="signs"></div>
    <div id="grid"></div>
    <div id="about">
      <h3>ü¶ã Galaktiƒçni Metulj ‚Äì Vizija 260 Src</h3>
<p>Dobrodo≈°el_a v <strong>Galaktiƒçnem Metulju</strong>, dihu Tzolkina, mre≈æi, ki povezuje 260 razliƒçnih galaktiƒçnih energij ‚Äî 260 src, 260 razliƒçnih izrazov istega Univerzalnega Bitja.</p>
<p>Vsak Kin je svetlobni piksel v kvantni tkanini, in ko se nas zbere vseh 260, se zgodi kvantni preskok v zavesti. Vsak, ki vnese svoj datum in ime, pri≈æge eno svetlobno toƒçko v metuljevem krilu ‚Äî svojo frekvenco, svoj dih, svojo barvo.</p>
<p>Ko se celica zasveti, se pri≈æge iskra spomina: ¬ªTukaj sem. Pripadam mre≈æi ≈Ωivljenja.¬´ Sodeluje≈° v kozmiƒçni igri ‚Äî a ta igra ima moƒç zdravljenja sveta.</p>
<p>ü™∂ Sodeluj.<br>
üåÄ Dodaj svoj Kin.<br>
üåà Pomagaj prebuditi celoten Galaktiƒçni Metulj ‚Äî simbol svetlobne mre≈æe, ki povezuje ljudi, srca in planete v eno skupno vibracijo Ljubezni.</p>
    </div>
  </div>
</div>

<form id="kinForm">
  <input type="text" id="name" placeholder="Ime" required>
  <input type="email" id="email" placeholder="Email" required>
  <input type="date" id="birthdate" required>
  <label><input type="checkbox" id="consent"> Strinjam se s politiko zasebnosti</label>
  <button type="submit">Dodaj</button>
</form>

<!-- sporoƒçilo ob vnosu -->
<div id="resultMessage" aria-live="polite" style="display:none;"></div>

<div id="list">
  <h3>Vneseni Kini:</h3>
  <ul id="userList"></ul>
</div>

<!-- modal -->
<div id="modalOverlay">
  <div id="modal" role="dialog" aria-modal="true" aria-labelledby="modalTitle">
    <h3 id="modalTitle">Kin</h3>
    <p id="modalKinTitle"></p>
    <div id="modalDescription"></div>
    <h4>Vpisani (samo imena):</h4>
    <ul id="modalNames"></ul>
    <button id="modalClose">Zapri ‚ú®</button>
  </div>
</div>

<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>
<script>
/* --- Firebase konfiguracija --- */
const firebaseConfig = { 
  apiKey: "AIzaSyAzFej1wNz-erdMtOPNA9DyCrSUYKXLLX8", 
  authDomain: "galakticni-metulj.firebaseapp.com", 
  databaseURL: "https://galakticni-metulj-default-rtdb.firebaseio.com", 
  projectId: "galakticni-metulj", 
  storageBucket: "galakticni-metulj.firebasestorage.app", 
  messagingSenderId: "283714253337", 
  appId: "1:283714253337:web:f0cf973fb36ef1ce9c3088", 
  measurementId: "G-MQ99G4S3N1" 
};
firebase.initializeApp(firebaseConfig);
const db = firebase.database();

/* --- TRADICIONALNA IMENA (slovensko, enostavno) --- */
const tzolkinSignNamesSimple = [
  "Krokodil","Veter","Noƒç","Seme",
  "Kaƒça","Smrt","Jelen","Zvezda",
  "Voda","Pes","Opica","Cesta",
  "Trstika","Jaguar","Orel","Sova",
  "Zemlja","Ogledalo","Nevihta","Sonce"
];

/* --- za prikaz v seznamu znakov uporabljamo obstojeƒçe pare (ohranjeno) --- */
const tzolkinSignImages = [
"https://static.wixstatic.com/media/7535eb_8b15827f3f0749f58b47edf2ec8ff34a~mv2.png",
"https://static.wixstatic.com/media/7535eb_da5c22d0b20c4650ae78bd78d44bdf90~mv2.png",
"https://static.wixstatic.com/media/7535eb_1431fb4ee97a418383209553a73974e5~mv2.png",
"https://static.wixstatic.com/media/7535eb_63fa92348cef45778a33ea8df474f3b8~mv2.png",
"https://static.wixstatic.com/media/7535eb_b144e80ceccc4304b10027e8d2f1e674~mv2.png",
"https://static.wixstatic.com/media/7535eb_9eda107ea6ed46e8880d6cd3394b3eca~mv2.png",
"https://static.wixstatic.com/media/7535eb_498008e2e9fb4c7ebc66e4a2cf25a1d4~mv2.png",
"https://static.wixstatic.com/media/7535eb_a86c9fe89c5f4f4d8a810c284e40bf13~mv2.png",
"https://static.wixstatic.com/media/7535eb_b1612f1d298245a483212ca3997b6872~mv2.png",
"https://static.wixstatic.com/media/7535eb_fcf459036d31451fb913cd556bdf98b1~mv2.png",
"https://static.wixstatic.com/media/7535eb_c5e4c01f59e74424806a8b82d55ea9c9~mv2.png",
"https://static.wixstatic.com/media/7535eb_8b1bd5f0bebf4e9e84734d0dd7c18a55~mv2.png",
"https://static.wixstatic.com/media/7535eb_5a43cbda692c4bff8790b8d4fe769ec5~mv2.png",
"https://static.wixstatic.com/media/7535eb_891ac2c5109f44c8927f69170b93aa78~mv2.png",
"https://static.wixstatic.com/media/7535eb_bcc1d28cea634696895554c9f25a2788~mv2.png",
"https://static.wixstatic.com/media/7535eb_acd453dcd54e4ca29483cb610e3bab2e~mv2.png",
"https://static.wixstatic.com/media/7535eb_d413aa3902864a09a3c2bb1ae2996b53~mv2.png",
"https://static.wixstatic.com/media/7535eb_57d9eafe0dd249ddb5194e43a629e516~mv2.png",
"https://static.wixstatic.com/media/7535eb_413ee006283f479dbb46cc737b796bb4~mv2.png",
"https://static.wixstatic.com/media/7535eb_18fc81a965aa4e69974f11d5bb68dc60~mv2.png"
];

const tzolkinSignNamesFull = [
"Imix / Krokodil","Ik / Veter","Akbal / Noƒç","Kan / Seme",
"Chicchan / Kaƒça","Cimi / Smrt","Manik / Jelen","Lamat / Zvezda",
"Muluc / Voda","Oc / Pes","Chuen / Opica","Eb / Cesta",
"Ben / Trstika","Ix / Jaguar","Men / Orel","Cib / Sova",
"Caban / Zemlja","Eznab / Ogledalo","Cauac / Nevihta","Ahau / Sonce"
];

/* --- prika≈æi znake v levi vrstici --- */
const signsContainer = document.getElementById('signs');
tzolkinSignImages.forEach((imgUrl, idx) => {
    const div = document.createElement('div');
    div.classList.add('sign');
    div.innerHTML = `<img src="${imgUrl}" alt="${tzolkinSignNamesFull[idx]}"> ${tzolkinSignNamesFull[idx]}`;
    signsContainer.appendChild(div);
});

/* --- Barve po vrstah: rdeƒça, bela, modra, rumena ... (ohranjeno) */
const rowColors = ['#f28c82','#ffffff','#aecbfa','#fff475'];

/* --- Ustvari mre≈æo 20x13 --- */
const cells = [];
const grid = document.getElementById('grid');
const kinCount = {};

for(let row=0; row<20; row++){
    for(let col=0; col<13; col++){
        const kinNumber = row + col*20 + 1;
        const cell = document.createElement('div');
        cell.classList.add('cell');
        cell.textContent = kinNumber;
        cell.setAttribute('data-kin', kinNumber);

        // nastavitev osnovne barve
        const baseColor = rowColors[row%4];
        cell.style.backgroundColor = baseColor;

        // dodaj listener za klik na celico - odpre modal s seznami
        cell.addEventListener('click', () => openKinModal(kinNumber));

        grid.appendChild(cell);
        cells.push(cell);
    }
}

/* --- Funkcija za izraƒçun Kina --- */
function calculateKin(dateStr){
    if(!dateStr) return 1;
    const startDate = new Date('1800-01-01');
    const startKin = 114;
    const birthDate = new Date(dateStr);
    const diffDays = Math.floor((birthDate - startDate)/(1000*60*60*24));
    return ((diffDays + startKin -1) % 260 + 260) % 260 +1;
}

/* --- Pomo≈æne funkcije za razlago: iz kina do imena znaka in tona --- */
function kinToSignIndex(kin){
  return (kin - 1) % 20; // 0..19
}
function kinToTone(kin){
  return ((kin - 1) % 13) + 1; // 1..13
}

/* TEMPLATES za tone (kratek, slovensko) */
const toneDescriptions = {
  1: "Glas zaƒçetka in iniciacije ‚Äî iskra, ki v≈æge pot.",
  2: "Dvojnost in sodelovanje ‚Äî odnosi nas uƒçijo ravnote≈æje.",
  3: "Ustvarjalnost in rast ‚Äî izraz svoje notranje zgodbe.",
  4: "Temelj in struktura ‚Äî zgradi stabilno bazo.",
  5: "Moƒç manifestacije ‚Äî tvoja volja prina≈°a rezultate.",
  6: "Jasnost in harmonija ‚Äî ƒças uskladiti in zdraviti.",
  7: "Refleksija in znanje ‚Äî potihni in poslu≈°aj modrost.",
  8: "Moƒç osebne spremembe ‚Äî transformacija skozi dejanje.",
  9: "Poglobitev in transparentnost ‚Äî zdravljenje iz notranjosti.",
  10: "Vodenje in vpliv ‚Äî prevzmi odgovornost s srcem.",
  11: "Vizija in ideje ‚Äî deli svoj navdih s svetom.",
  12: "Integracija in slu≈æenje ‚Äî pove≈æi se v skupno dobro.",
  13: "Karmiƒçna ƒçarovnija ‚Äî skrivnosti in preobrazba."
};

/* Kratke definicije za 20 znakov v sloven≈°ƒçini (tradicionalno, preprosto) */
const signShortDesc = {
  "Krokodil": "Izvor energije, zaƒçetek, materinska moƒç.",
  "Veter": "Gibanje, komunikacija, zrak idej.",
  "Noƒç": "Sanje, notranji svet, intuicija.",
  "Seme": "Rast, mo≈ænost, potencial novih zadev.",
  "Kaƒça": "Transformacija, ≈æivljenjska sila, preobrazba.",
  "Smrt": "Konec kot preobrazba, oƒçi≈°ƒçenje.",
  "Jelen": "Zaledje, pomoƒç, srƒçna moƒç.",
  "Zvezda": "Umetnost, harmonija, estetska lepota.",
  "Voda": "ƒåustva, oƒçi≈°ƒçevalna energija, vez.",
  "Pes": "Zvestoba, slu≈æenje, dru≈æina.",
  "Opica": "Igrivost, ustvarjalnost, iznajdljivost.",
  "Cesta": "Usmerjenost, usoda, poti v ≈æivljenju.",
  "Trstika": "Rast, razvijanje moƒçi in stabilnosti.",
  "Jaguar": "Moƒç senc, za≈°ƒçita, notranja moƒç.",
  "Orel": "Razgled, ≈°irina, duhovna perspektiva.",
  "Sova": "Modrost, noƒçno videnje, zaznavanje resnice.",
  "Zemlja": "Opora, sinhronost z naravo, stabilnost.",
  "Ogledalo": "Refleksija, resnica, jasno zrcalo.",
  "Nevihta": "Moƒçna transformacija, oƒçi≈°ƒçevalni vihar.",
  "Sonce": "Izpolnitev, svetloba, srƒçna moƒç."
};

/* --- Osvetli Kin v mre≈æi z animacijo zlatega okvirƒçka --- */
function highlightKin(kin){
    const cell = cells.find(c => parseInt(c.dataset.kin) === kin);
    if(!cell) return;

    // poveƒçaj ≈°tevec za ta kin
    kinCount[kin] = (kinCount[kin] || 0) + 1;

    // spremeni barvo ozadja
    const baseRow = (kin - 1) % 20;
    const baseColor = rowColors[baseRow % 4];
    const colorMap = {
        '#f28c82':'#c1272d',
        '#ffffff':'#cccccc',
        '#aecbfa':'#3c78d8',
        '#fff475':'#f1c232'
    };
    cell.style.backgroundColor = colorMap[baseColor] || baseColor;

    // dodaj animacijo, ƒçe ≈°e ni
    if(!cell.classList.contains('cell-highlight')){
        cell.classList.add('cell-highlight');
    }

    // posodobi ≈°tevec v celici ‚Äì vedno poka≈æe pravi count
    let counter = cell.querySelector('.cell-counter');
    if(!counter){
        counter = document.createElement('div');
        counter.classList.add('cell-counter');
        cell.appendChild(counter);
    }
    counter.textContent = kinCount[kin];  // tu se vedno poka≈æe pravi count
}

/* --- Poslu≈°anje novih uporabnikov v realnem ƒçasu in urejen seznam --- */
const userList = document.getElementById('userList');
const users = []; // lokalni array za vse uporabnike

db.ref('users').on('child_added', snapshot => {
    const data = snapshot.val();
    const {name, kin} = data;

    // dodaj uporabnika v lokalni array
    users.push({name, kin});

    // sortiraj po kin
    users.sort((a, b) => a.kin - b.kin);

    // poƒçisti trenutno listo in izpi≈°i po vrsti
    userList.innerHTML = '';
    users.forEach(u => {
        const li = document.createElement('li');
        li.textContent = `${u.name} - Kin: ${u.kin}`;
        userList.appendChild(li);
    });

    // Osvetli Kin v mre≈æi
    highlightKin(kin);

    // posodobi ≈°tevec (prav tako posodablja spodnji on('value') handler)
});

/* --- ≈†tetje aktivnih Kinov (v realnem ƒçasu) --- */
const activeCountEl = document.getElementById('activeCount');
db.ref('users').on('value', snapshot => {
  const count = snapshot.numChildren();
  activeCountEl.textContent = count;
});

/* --- Modal: odpri in prika≈æi imena za ta kin --- */
const modalOverlay = document.getElementById('modalOverlay');
const modalKinTitle = document.getElementById('modalKinTitle');
const modalNames = document.getElementById('modalNames');
const modalDescription = document.getElementById('modalDescription');
const modalClose = document.getElementById('modalClose');
const modalTitle = document.getElementById('modalTitle');

function openKinModal(kin){
  modalOverlay.style.display = 'flex';
  const signName = tzolkinSignNamesSimple[kinToSignIndex(kin)];
  const tone = kinToTone(kin);
  modalTitle.textContent = `Kin ${kin} ‚Äî ${tone} Ton`;
  modalKinTitle.textContent = `Kin ${kin} ‚Äì ${tone} ${signName}`;
  modalDescription.innerHTML = `<p><strong>Opis:</strong> ${toneDescriptions[tone]} ${signShortDesc[signName] ? " " + signShortDesc[signName] : ""}</p>`;

  // poƒçisti seznam imen
  modalNames.innerHTML = '<li>nalaganje‚Ä¶</li>';

  // poizvedba v Firebase za vse z istim kinom (samo imena)
  db.ref('users').orderByChild('kin').equalTo(kin).once('value', snap => {
    const val = snap.val();
    modalNames.innerHTML = '';
    if(!val){
      modalNames.innerHTML = '<li>(≈°e nihƒçe ni vpisan)</li>';
      return;
    }
    Object.values(val).forEach(user => {
      const li = document.createElement('li');
      li.textContent = user.name;
      modalNames.appendChild(li);
    });
  });
}

function closeModal(){
  modalOverlay.style.display = 'none';
}
modalClose.addEventListener('click', closeModal);
modalOverlay.addEventListener('click', (e) => { if(e.target === modalOverlay) closeModal(); });

/* --- Dodajanje uporabnika --- */
document.getElementById('kinForm').addEventListener('submit', function(e){
    e.preventDefault();
    const name = document.getElementById('name').value.trim();
    const email = document.getElementById('email').value.trim();
    const birthdate = document.getElementById('birthdate').value;
    const consent = document.getElementById('consent').checked;

    if(!consent){ alert('Prosimo, sprejmite politiko zasebnosti.'); return; }

    const kin = calculateKin(birthdate);

    const newUserRef = db.ref('users').push();
    newUserRef.set({name, email, birthdate, kin})
      .then(() => {
        // Ob vnosu: prika≈æi spodnje sporoƒçilo z razlago (sloven≈°ƒçina)
        showResultMessage(kin);

        // poi≈°ƒçi celico in izvedi scroll + ugasni ripple/ƒçez ƒças
        const cell = cells.find(c=>parseInt(c.textContent)===kin);
        if(cell){
          // scroll v sredi≈°ƒçe pogleda
          cell.scrollIntoView({ behavior: "smooth", block: "center", inline: "center" });

          // dodaj ripple in poudarek
          cell.classList.add('cell-ripple');
          cell.classList.add('highlight-focus');

          // odstranimo enkratni ripple po 1400ms in highlight fokus po 2200ms
          setTimeout(()=> cell.classList.remove('cell-ripple'), 1400);
          setTimeout(()=> cell.classList.remove('highlight-focus'), 2200);
        }

        // reset forme
        document.getElementById('kinForm').reset();
      })
      .catch(err => {
        console.error("Napaka pri vnosu v Firebase:", err);
        alert("Pri≈°lo je do napake pri shranjevanju. Poskusi znova.");
      });
});

/* --- Funkcija za prikaz sporoƒçila spodaj z razlago (sloven≈°ƒçina) --- */
const resultMessageEl = document.getElementById('resultMessage');
function showResultMessage(kin){
  const signName = tzolkinSignNamesSimple[kinToSignIndex(kin)];
  const tone = kinToTone(kin);
  const toneText = toneDescriptions[tone] || "";
  const signText = signShortDesc[signName] || "";
  resultMessageEl.style.display = 'block';
  resultMessageEl.innerHTML = `<strong>Tvoj Kin je ${kin} ‚Äì ${tone} ${signName}.</strong><br>${toneText} ${signText}`;
  // po 10s poƒçisti sporoƒçilo (ne≈æno)
  setTimeout(()=> {
    resultMessageEl.style.opacity = '1';
    setTimeout(()=> {
      resultMessageEl.style.transition = 'opacity 0.8s ease';
      resultMessageEl.style.opacity = '0';
      setTimeout(()=> { resultMessageEl.style.display='none'; resultMessageEl.style.opacity='1'; resultMessageEl.style.transition=''; }, 900);
    }, 9000);
  }, 400);
}

/* --- OPTIONAL: ob zagonu nalo≈æi obstojeƒçe vne≈°ene uporabnike (ƒçe ≈æe niso nalo≈æeni) --- */
/* ƒåe podatki ≈æe prispejo preko child_added, zgornji on('child_added') poskrbi za osvetlitev in seznam,
   zato tu ni treba posebej jemati snapshot. */

/* --- Dodaten: ko klikne≈° na katerikoli element v #list, scrolaj do kin (lahek UX) --- */
document.getElementById('userList').addEventListener('click', (e)=>{
  const text = e.target.textContent || "";
  const match = text.match(/Kin:\s*(\d+)/i);
  if(match){
    const kin = parseInt(match[1]);
    const cell = cells.find(c=>parseInt(c.textContent)===kin);
    if(cell){
      cell.scrollIntoView({ behavior: "smooth", block: "center", inline: "center" });
      cell.classList.add('cell-ripple');
      setTimeout(()=> cell.classList.remove('cell-ripple'), 1400);
    }
  }
});
</script>
</body>
</html>